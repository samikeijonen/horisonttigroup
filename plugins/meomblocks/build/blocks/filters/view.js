(()=>{"use strict";const e=window.wp.url;function t(e,t){if(void 0===e||0>=t.length)return;const s="true"===e.getAttribute(`aria-${t}`)?"false":"true";e.setAttribute(`aria-${t}`,s)}function s(e,t,s={}){this._handleNav=this.handleNav.bind(this),this._handleSubNav=this.handleSubNav.bind(this),this._handleCloseNav=this.handleCloseNav.bind(this),this._handleCloseSubNav=this.handleCloseSubNav.bind(this),this._closeAllSubMenus=this.closeAllSubMenus.bind(this),this._closeAllSubSubMenus=this.closeAllSubSubMenus.bind(this),this._setSubMenu=this.setSubMenu.bind(this),this._closeAllSubMenuToggles=this.closeAllSubMenuToggles.bind(this),this._closeAllSubSubMenuToggles=this.closeAllSubSubMenuToggles.bind(this),this._handleDocClick=this.handleDocClick.bind(this),this._handleFocus=this.handleFocus.bind(this);const n={action:"click",subNavAnchors:".js-site-nav-items > .menu-item-has-children > a",subSubNavAnchors:".js-site-nav-items .sub-menu > .menu-item-has-children > a",toggleNavClass:!0,toggleNavClassValue:"is-opened",toggleSubNavClassValue:"is-opened",closeNavOnEscKey:!0,closeNavOnLastTab:!1,closeNavOnDocClick:!0,subNavClass:".sub-menu",subToggleButtonClasses:"",subSubToggleButtonClasses:"",animateSubNav:!1,animateSubNavClass:"",visuallyHiddenClass:"screen-reader-text",expandChildNavText:"Sub menu",dropDownIcon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"><path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"></path></svg>',onCreate:null,onOpenNav:null,onCloseNav:null,onOpenSubNav:null,onCloseSubNav:null,...s};this.$element=e,this.$toggle=t,this.settings=n,this.navOpened=!1,this.$subNavs=this.$element.querySelectorAll(this.settings.subNavAnchors),this.$subSubNavs=this.$element.querySelectorAll(this.settings.subSubNavAnchors),this.create()}s.prototype.create=function(){return this.$toggle.setAttribute("aria-expanded","false"),this.$element.setAttribute("data-meom-nav","navigation"),this.$subNavs.forEach(function(e){"click"===this.settings.action&&e.setAttribute("hidden","");const t=document.createElement("button");t.setAttribute("data-meom-nav","sub-toggle"),t.setAttribute("aria-expanded","false"),t.className=`${this.settings.subToggleButtonClasses}`,t.type="button","click"===this.settings.action&&(t.innerHTML=`${e.innerHTML}${this.settings.dropDownIcon}`),"hover"===this.settings.action&&(t.innerHTML=`<span class="${this.settings.visuallyHiddenClass}">${this.settings.expandChildNavText}</span>${this.settings.dropDownIcon}`),e.after(t)},this),this.$subSubNavs.forEach(function(e,t){const s=document.createElement("button");s.setAttribute("data-meom-nav","sub-sub-toggle"),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",`sub-sub-menu-${t}`),e.nextElementSibling&&(e.nextElementSibling.id=`sub-sub-menu-${t}`),s.className=`${this.settings.subSubToggleButtonClasses}`,s.type="button",s.innerHTML=`<span class="${this.settings.visuallyHiddenClass}">${this.settings.expandChildNavText}</span>${this.settings.dropDownIcon}`,e.after(s)},this),this.$toggle.addEventListener("click",this._handleNav,!1),this.$element.addEventListener("click",this._handleSubNav,!1),document.addEventListener("keydown",this._handleCloseNav,!1),this.$element.addEventListener("keydown",this._handleCloseSubNav,!1),this.$element.addEventListener("keydown",this._handleFocus,!1),document.addEventListener("click",this._handleDocClick,!1),this.settings.onCreate&&"function"==typeof this.settings.onCreate&&this.settings.onCreate(this.$element,this.$toggle),this},s.prototype.handleNav=function(e){return this.navOpened?(t(this.$toggle,"expanded"),this.settings.toggleNavClass&&this.$element.classList.remove(this.settings.toggleNavClassValue),this.$toggle&&this.$toggle.focus(),this.navOpened=!1,this._closeAllSubMenus(),this._closeAllSubMenuToggles(),this.settings.onCloseNav&&"function"==typeof this.settings.onCloseNav&&this.settings.onCloseNav(this.$element,this.$toggle,e)):(t(this.$toggle,"expanded"),this.settings.toggleNavClass&&this.$element.classList.add(this.settings.toggleNavClassValue),this.navOpened=!0,this.settings.onOpenNav&&"function"==typeof this.settings.onOpenNav&&this.settings.onOpenNav(this.$element,this.$toggle,e)),this},s.prototype.handleSubNav=function(e){const s=e.target,n=s.closest('[data-meom-nav="sub-toggle"]'),a=s.closest('[data-meom-nav="sub-sub-toggle"]');return n||a?(s.nextElementSibling.classList.contains(this.settings.toggleSubNavClassValue)||s.matches('[data-meom-nav="sub-sub-toggle"]')||(this._closeAllSubMenus(),this._closeAllSubMenuToggles()),!s.nextElementSibling.classList.contains(this.settings.toggleSubNavClassValue)&&s.matches('[data-meom-nav="sub-sub-toggle"]')&&(this._closeAllSubSubMenus(s),this._closeAllSubSubMenuToggles(s)),t(s,"expanded"),s.nextElementSibling&&this._setSubMenu(s.nextElementSibling,e),this):this},s.prototype.handleCloseNav=function(e){return this.navOpened&&this.settings.closeNavOnEscKey&&27===e.keyCode&&this._handleNav(e),this},s.prototype.handleCloseSubNav=function(e){const t=document.querySelector(`${this.settings.subNavClass}.${this.settings.toggleSubNavClassValue}`);if(t){const s=t.querySelectorAll(["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])"]),n=s[s.length-1];9!==e.keyCode||e.shiftKey||e.target!==n||(this._closeAllSubMenus(),this._closeAllSubMenuToggles());const a=t.previousElementSibling;a&&9===e.keyCode&&e.shiftKey&&e.target===a&&(this._closeAllSubMenus(),this._closeAllSubMenuToggles())}if(27===e.keyCode){if(e.target.matches('[data-meom-nav="sub-toggle"][aria-expanded="true"]'))return this._handleSubNav(e),this._closeAllSubMenus(),this._closeAllSubMenuToggles(),this;const t=e.target.closest(`${this.settings.subNavClass}.${this.settings.toggleSubNavClassValue}`);if(t){const e=t.previousElementSibling;e&&e.focus()}this._closeAllSubMenus(),this._closeAllSubMenuToggles()}return this},s.prototype.handleFocus=function(e){if(!this.navOpened)return this;if(!this.settings.closeNavOnLastTab)return this;const t=this.$element.querySelectorAll(["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])"]),s=t[t.length-1];return 9!==e.keyCode||e.shiftKey||e.target!==s||(e.preventDefault(),this._handleNav(e)),this},s.prototype.handleDocClick=function(e){return e.target.closest('[data-meom-nav="navigation"]')?this:this.settings.closeNavOnDocClick?(this._closeAllSubMenus(),this._closeAllSubMenuToggles(),this):this},s.prototype.closeAllSubMenus=function(){return document.querySelectorAll(`${this.settings.subNavClass}.${this.settings.toggleSubNavClassValue}`).forEach(function(e){this._setSubMenu(e)},this),this},s.prototype.closeAllSubSubMenus=function(e){return e.closest(`${this.settings.subNavClass}.${this.settings.toggleSubNavClassValue}`).querySelectorAll(`${this.settings.subNavClass}.${this.settings.toggleSubNavClassValue}`).forEach(function(e){this._setSubMenu(e)},this),this},s.prototype.setSubMenu=function(e,t){return e?(e.classList.contains(this.settings.toggleSubNavClassValue)?(e.classList.remove(this.settings.toggleSubNavClassValue),this.settings.onCloseSubNav&&"function"==typeof this.settings.onCloseSubNav&&this.settings.onCloseSubNav(this.$element,this.$toggle,e,t)):(e.classList.add(this.settings.toggleSubNavClassValue),this.settings.animateSubNav&&(s=e,n=this.settings.animateSubNavClass,s&&n&&(s.classList.add(n),s.addEventListener("animationend",function e(){s.classList.remove(n),s.removeEventListener("animationend",e,!1)},!1))),this.settings.onOpenSubNav&&"function"==typeof this.settings.onOpenSubNav&&this.settings.onOpenSubNav(this.$element,this.$toggle,e,t)),this):this;var s,n},s.prototype.closeAllSubMenuToggles=function(){return document.querySelectorAll('[data-meom-nav="sub-toggle"][aria-expanded="true"]').forEach(function(e){t(e,"expanded")}),document.querySelectorAll('[data-meom-nav="sub-sub-toggle"][aria-expanded="true"]').forEach(function(e){t(e,"expanded")}),this},s.prototype.closeAllSubSubMenuToggles=function(e){return e.closest(`${this.settings.subNavClass}.${this.settings.toggleSubNavClassValue}`).querySelectorAll('[data-meom-nav="sub-sub-toggle"][aria-expanded="true"]').forEach(function(e){t(e,"expanded")}),this};const n=window.wp.a11y,a=function(e,t){if(!e||!t&&0!==t)return;const s=document.querySelector(`input[data-meom-filters="${e}"][value="${t}"]`);if(!s)return;const n=s.getAttribute("data-meom-filters-label");if(!n)return;const a=document.createElement("button");return a.type="button",a.setAttribute("data-meom-filters","remove-filter"),a.setAttribute("data-meom-filters-key",e),a.setAttribute("data-meom-filters-value",t),a.className="filters__remove-filter",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z" /></svg>'+n,a},i=function(t=!1,s,o,l,u,r){if(s.tax_query=[],s.meta_query=[],o={},"house"===l){const e=function(e){const t={};return e.forEach((e,s)=>{Reflect.has(t,s)?(Array.isArray(t[s])||(t[s]=[t[s]]),t[s].push(e)):t[s]=e}),t}(new FormData(u)),t=r[l].tax_query;if(t)for(const n of t)e[n.name]&&e[n.name].length>0&&(s.tax_query.push({taxonomy:n.taxonomy,field:"slug",terms:e[n.name]}),o[n.urlKey]=e[n.name]);const n=r[l].order.name;e[n]&&("newest-first"===e[n]&&(s.orderby="date",s.order="DESC"),"oldest-first"===e[n]&&(s.orderby="date",s.order="ASC"),"title-asc"===e[n]&&(s.orderby="post_title",s.order="ASC"),"title-desc"===e[n]&&(s.orderby="post_title",s.order="DESC"),"newest-first"!==e[n]&&(o[r.post.order.urlKey]=e[n])),s.s="",e[r.search.name]&&(s.s=e[r.search.name],o[r.search.urlKey]=e[r.search.name])}const c=document.querySelector('input[name="language_code"]');c&&(s.language_code=c.value);const d=document.querySelector('input[name="lang"]');d&&(s.lang=d.value),s.paged=t?1+s.paged:1,function(t,s=!1){const a=document.querySelector('[data-meom-filters="items-content"]');if(!a)return;const i=document.querySelector('[data-meom-filters="spinner"]'),o=document.querySelector('[data-meom-filters="load-more"]');t&&(a.classList.add("is-loading"),i&&i.removeAttribute("hidden"),fetch((0,e.addQueryArgs)("/wp-json/wp_query/args/",t)).then(function(e){if(e.ok){const s=parseInt(e.headers.get("x-wp-totalpages"),10);t.pages=s;const n=parseInt(e.headers.get("x-wp-total"),10);t.count=n;const a=document.querySelector('[data-meom-filters="submit-count"]');return a&&(a.innerHTML=`&nbsp;(${n})`),function(e,t,s){t&&(s.paged>=e?t.setAttribute("hidden",""):t.removeAttribute("hidden"))}(s,o,t),e.json()}return Promise.reject(e)}).then(function(e){const t=e.html?e.html:`<p>${e.messages.empty}</p>`;s?a.innerHTML+=t:(a.innerHTML="",a.innerHTML=t),a.classList.remove("is-loading"),i&&i.setAttribute("hidden","");const o=e.html?e.messages.success:e.messages.empty;(0,n.speak)(o)}).catch(function(e){console.warn("Something went wrong.",e),a.classList.remove("is-loading"),i&&i.setAttribute("hidden","")}))}(s,t),function(e=!1,t,s,n,o,l){const u=document.querySelector('[data-meom-filters="selected"]');if(u){if(u.innerHTML="",t.tax_query.length>0){const e=t.tax_query;for(const t of e)if(Array.isArray(t.terms))for(const e of t.terms){const s=a(t.taxonomy,e);s&&u.appendChild(s)}else{const e=a(t.taxonomy,t.terms);e&&u.appendChild(e)}const s=document.createElement("button");s.type="button",s.setAttribute("data-meom-filters","reset"),s.className="filters__reset",s.innerHTML="Poista kaikki valinnat",u.appendChild(s)}document.addEventListener("click",function(a){const u=a.target.closest('[data-meom-filters="remove-filter"]');if(!u)return;const r=u.getAttribute("data-meom-filters-key"),c=u.getAttribute("data-meom-filters-value"),d=document.querySelector('input[data-meom-filters="'+r+'"][value="'+c+'"]');d&&(d.checked=!1,i(e,t,s,n,o,l))},!1)}}(t,s,o,l,u,r),function(e){const t=document.querySelector(".js-filters-count");if(t){const s=function(e){const t=e.querySelectorAll('input[type="checkbox"]'),s=[];return t.forEach(e=>{e.checked&&s.push(e.value)}),s}(e);t.innerHTML=s.length}}(u);const h=Object.entries(o).length>0?"?"+new URLSearchParams(o).toString():`${location.protocol}//${location.host}${location.pathname}`;history.replaceState(s,document.title,h)},o=JSON.parse('{"house":{"tax_query":[{"taxonomy":"house-price-category","name":"tax-house-price-category","urlKey":"hinta"},{"taxonomy":"house-cash-flow","name":"tax-house-cash-flow","urlKey":"kassavirta"},{"taxonomy":"house-rental-income","name":"tax-house-rental-income","urlKey":"vuokratuotto"},{"taxonomy":"house-type","name":"tax-house-type","urlKey":"huoneita"},{"taxonomy":"house-city","name":"tax-house-city","urlKey":"sijainti"},{"taxonomy":"house-status","name":"tax-house-status","urlKey":"status"}],"meta_query":[],"order":{"name":"order","urlKey":"orderBy","options":[{"value":"title-asc","label":"By title asc","default":true},{"value":"title-desc","label":"By title desc"},{"value":"newest-first","label":"Newest first"},{"value":"oldest-first","label":"Oldest first"}]}},"search":{"name":"s","urlKey":"searchBy"}}');(()=>{const s=document.querySelector('[data-meom-filters="form"]');if(!s)return;const n=document.querySelector('[data-meom-filters="filters-wrapper"]'),a=document.querySelector('[data-meom-filters="load-more"]'),l=document.querySelector('[data-meom-filters="filters-toggle"]'),u=document.querySelector('[data-meom-filters="close"]'),r=document.querySelector('[data-meom-filters="overlay"]'),c=document.querySelector('[data-meom-filters="submit"]'),d=document.querySelector('[data-meom-filters="reset"]'),h=s.getAttribute("data-meom-filters-post-type")?s.getAttribute("data-meom-filters-post-type"):"customer",g={post_type:h,posts_per_page:12,paged:1},m={};function b(e){e.preventDefault(),i(!1,g,m,h,s,o)}function v(){n.classList.toggle("is-opened"),t(l,"expanded"),document.querySelector("html").classList.toggle("filters-scroll-stop")}function f(){s.reset();const t=(0,e.getQueryArgs)(document.location.href);if(Object.entries(t).length>0){const e=o[h].tax_query;if(e)for(const n of e){const e=t[n.urlKey];if(e&&e.length>0){const t=s.querySelectorAll(`[name="${n.name}"]`),a=e.split(",");t.forEach(e=>{a.includes(e.value)&&(e.checked=!0)})}}if(t[o[h].order.urlKey]){const e=document.querySelector(`[name="${o[h].order.name}"] option[value="${t[o[h].order.urlKey]}"]`);e&&(e.selected=!0)}if(t[o.search.urlKey]){const e=document.querySelector(`[name="${o.search.name}"]`);e&&(e.value=t[o.search.urlKey])}}i(!1,g,m,h,s,o)}s.addEventListener("change",b,!1),s.addEventListener("submit",b,!1),a&&a.addEventListener("click",function(){i(!0,g,m,h,s,o)},!1),l&&l.addEventListener("click",v,!1),u&&u.addEventListener("click",v,!1),r&&r.addEventListener("click",v,!1),c&&c.addEventListener("click",v,!1),d&&document.addEventListener("click",function(e){e.target.closest('[data-meom-filters="reset"]')&&(s.reset(),i(!1,g,m,h,s,o))},!1),s.addEventListener("click",function(e){e.target.closest('[data-meom-filters="fieldset-toggle"]')&&t(e.target,"expanded")},!1),document.addEventListener("click",function(e){e.target.closest('[data-meom-filters="filters-wrapper"]')||e.target.closest('[data-meom-filters="form"]')||n&&n.classList.contains("is-opened")&&v()},!1),window.addEventListener("popstate",f),f()})()})();